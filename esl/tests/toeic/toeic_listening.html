<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TOEIC Listen Sample Test Fase 2</title>
  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --accent:#1f6feb;
      --muted:#666;
      --shadow: 0 6px 18px rgba(20,20,40,0.06);
      --radius:10px;
    }
    body{
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:#111;
      margin:0;
      padding:24px;
      display:flex;
      justify-content:center;
    }
    .container{
      width:100%;
      max-width:980px;
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:20px;
    }
    header{
      display:flex;
      gap:16px;
      align-items:center;
      margin-bottom:12px;
    }
    header h1{ font-size:20px; margin:0; }
    .meta{ color:var(--muted); font-size:13px; }
    audio{ width:100%; margin:12px 0; }
    .student-row{ display:flex; gap:12px; margin:10px 0; align-items:center; }
    .student-row input[type="text"]{ flex:1; padding:8px 10px; border-radius:8px; border:1px solid #ddd; }
    .questions{ display:grid; grid-template-columns:repeat(2,1fr); gap:12px; margin-top:8px; }
    .qcard{
      border-radius:8px; padding:10px; border:1px solid #eee; background: #fbfcff;
      display:flex; align-items:center; justify-content:space-between;
    }
    .qleft{ font-weight:600; color:#222; }
    .choices{ display:flex; gap:8px; align-items:center; }
    label.choice{ display:inline-flex; align-items:center; gap:6px; border-radius:6px; padding:6px 8px; cursor:pointer; user-select:none; border:1px solid transparent;}
    input[type="radio"]{ accent-color: var(--accent); }
    .actions{ display:flex; gap:8px; margin-top:16px; flex-wrap:wrap; }
    button, a.btn{
      background:var(--accent); color:white; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; text-decoration:none;
      box-shadow: 0 6px 12px rgba(31,111,235,0.12);
    }
    button.secondary{ background:#4caf50; }
    button.ghost{ background:transparent; color:var(--accent); box-shadow:none; border:1px solid #d6e4ff; }
    small.note{ display:block; margin-top:8px; color:var(--muted); }
    footer{ margin-top:18px; font-size:13px; color:var(--muted); }
    @media(max-width:700px){
      .questions{ grid-template-columns:1fr; }
    }
  </style>
</head>
<body>
  <div class="container" role="main">
    <header>
      <div>
        <h1>TOEIC Listen Sample test — Part 1 Fase 2 (Questions 11–40)</h1>
        <div class="meta">Escute com atenção e escolha <strong>A, B ou C</strong> para cada pergunta.</div>
      </div>
    </header>

    <!-- Audio: coloque "02 Faixa 2.mp3" na mesma pasta do HTML -->
    <audio controls preload="metadata">
      <source src="p1F2.mp3" type="audio/mpeg">
      Seu navegador não suporta o elemento de áudio.
    </audio>

    <div class="student-row" style="margin-top:6px;">
      <input id="studentName" type="text" placeholder="Student name (optional)" />
      <input id="studentEmail" type="text" placeholder="Student email (optional)" />
    </div>

    <form id="testForm" autocomplete="off">
      <div class="questions" id="questionsGrid">
        <!-- Questions generated by JS -->
      </div>

      <div class="actions">
        <button type="button" id="btnEmail">Send by Email</button>
        <button type="button" id="btnWhatsApp" class="secondary">Send by WhatsApp</button>
        <button type="button" id="btnSheet" class="ghost">Submit to Google Sheet</button>
      </div>

      <small class="note">You can use more than one send option. If you use Google Sheet, follow the instructions provided to deploy the Apps Script and paste the web app URL below.</small>

      <div style="margin-top:10px;">
        <input id="sheetUrl" type="text" placeholder="Paste Google Apps Script Web App URL here (optional)" style="width:100%; padding:8px; border-radius:8px; border:1px solid #ddd;" />
      </div>
    </form>

    <footer>
      <div>To receive answers by email: <strong>vilela0928@gmail.com</strong></div>
      <div>To receive answers by WhatsApp: <strong>+55 94 99120-5300</strong></div>
    </footer>
  </div>

  <script>
    // --- Configuration (edit if needed) ---
    const TEACHER_EMAIL = "vilela0928@gmail.com";
    const TEACHER_WHATSAPP = "+5594991205300"; // used to form wa.me link
    // NOTE: Paste your deployed Apps Script web app URL into the input "sheetUrl"

    // --- Build questions 11..40 ---
    const questionsContainer = document.getElementById('questionsGrid');
    const startQ = 11;
    const endQ = 40;
    for(let q = startQ; q <= endQ; q++){
      const card = document.createElement('div');
      card.className = 'qcard';
      const left = document.createElement('div');
      left.className = 'qleft';
      left.textContent = q + '.';
      const choices = document.createElement('div');
      choices.className = 'choices';
      ['A','B','C'].forEach(opt=>{
        const id = `q${q}_${opt}`;
        const label = document.createElement('label');
        label.className = 'choice';
        label.htmlFor = id;
        const input = document.createElement('input');
        input.type = 'radio';
        input.name = `q${q}`;
        input.id = id;
        input.value = opt;
        const span = document.createElement('span');
        span.textContent = opt;
        label.appendChild(input);
        label.appendChild(span);
        choices.appendChild(label);
      });
      card.appendChild(left);
      card.appendChild(choices);
      questionsContainer.appendChild(card);
    }

    // --- Helpers to collect answers ---
    function collectAnswers(){
      const name = document.getElementById('studentName').value.trim();
      const email = document.getElementById('studentEmail').value.trim();
      const answers = {};
      for(let q = startQ; q <= endQ; q++){
        const radios = document.getElementsByName(`q${q}`);
        let selected = '';
        for(const r of radios){ if(r.checked){ selected = r.value; break; } }
        answers[q] = selected; // '' if none selected
      }
      return { name, email, answers };
    }

    function formatAnswersText(obj){
      const lines = [];
      if(obj.name) lines.push(`Name: ${obj.name}`);
      if(obj.email) lines.push(`Email: ${obj.email}`);
      lines.push(`Submitted at: ${new Date().toLocaleString()}`);
      lines.push('');
      lines.push('Answers:');
      for(let q = startQ; q <= endQ; q++){
        lines.push(`${q}: ${obj.answers[q] || '-'}`);
      }
      return lines.join('\n');
    }

    // --- Email sending (mailto) ---
    document.getElementById('btnEmail').addEventListener('click', ()=>{
      const data = collectAnswers();
      const body = encodeURIComponent(formatAnswersText(data));
      const subject = encodeURIComponent('TOEIC Listening Answers - ' + (data.name || 'Student'));
      // mailto link
      const mailto = `mailto:${TEACHER_EMAIL}?subject=${subject}&body=${body}`;
      window.location.href = mailto;
    });

    // --- WhatsApp sending ---
    document.getElementById('btnWhatsApp').addEventListener('click', ()=>{
      const data = collectAnswers();
      const text = encodeURIComponent(formatAnswersText(data));
      // Using wa.me link (international number, no + or spaces)
      // Use wa.me/<number>?text=<text>
      const phone = TEACHER_WHATSAPP.replace(/[^0-9]/g, '');
      const waUrl = `https://wa.me/${phone}?text=${text}`;
      window.open(waUrl, '_blank');
    });

    // --- Submit to Google Sheet via Apps Script POST ---
    async function postToSheet(webAppUrl, payload){
      try{
        const res = await fetch(webAppUrl, {
          method: 'POST',
          mode: 'cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });
        const text = await res.text();
        return { ok: res.ok, text };
      } catch(err){
        return { ok:false, error: String(err) };
      }
    }

    document.getElementById('btnSheet').addEventListener('click', async ()=>{
      const webAppUrl = document.getElementById('sheetUrl').value.trim();
      if(!webAppUrl){
        alert('Please paste your Google Apps Script Web App URL in the box below first.');
        return;
      }
      const data = collectAnswers();
      const payload = {
        timestamp: new Date().toISOString(),
        studentName: data.name,
        studentEmail: data.email,
        answers: data.answers,
        teacherEmail: TEACHER_EMAIL
      };
      const loadingBtn = document.getElementById('btnSheet');
      loadingBtn.textContent = 'Submitting...';
      loadingBtn.disabled = true;
      const result = await postToSheet(webAppUrl, payload);
      loadingBtn.disabled = false;
      loadingBtn.textContent = 'Submit to Google Sheet';
      if(result.ok){
        alert('Submitted to Google Sheet successfully!');
      } else {
        console.error(result);
        alert('Error submitting to Google Sheet. See console for details.');
      }
    });

    // Optional: simple validation before send (example)
    // If you want to force all answers, uncomment the check in collectAnswers/use it before send.

  </script>
</body>
</html>


